---
import PaginationContent from "@/components/ui/pagination/pagination-content.astro"
import PaginationItem from "@/components/ui/pagination/pagination-item.astro"
import PaginationNext from "@/components/ui/pagination/pagination-next.astro"
import PaginationPrevious from "@/components/ui/pagination/pagination-previous.astro"
import Pagination from "@/components/ui/pagination/pagination.astro"
import type { SelectArticle } from "@/server/db/schema"
import { api } from "@/trpc/server"
import ArticleCard from "./article-card.astro"

interface Props {
  page?: number
  perPage?: number
}

const { page = 1, perPage = 10 } = Astro.props

const articles: SelectArticle[] = await api.article.byLanguage({
  language: "id",
  page,
  perPage,
})

const totalArticles = await api.article.countByLanguage("id")

const totalPages = Math.ceil(totalArticles / perPage)
const currentPage = page
---

<div class="space-y-3">
  {articles.map((article: SelectArticle) => <ArticleCard article={article} />)}
</div>

{
  totalPages > 1 && (
    <div class="mt-6">
      <Pagination>
        <PaginationContent>
          {currentPage > 1 && (
            <PaginationItem>
              <PaginationPrevious href={`/article?page=${currentPage - 1}`} />
            </PaginationItem>
          )}
          {currentPage < totalPages && (
            <PaginationItem>
              <PaginationNext href={`/article?page=${currentPage + 1}`} />
            </PaginationItem>
          )}
        </PaginationContent>
      </Pagination>
    </div>
  )
}
